

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>setlyze.report &mdash; SETLyze 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="SETLyze 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    <li><a href="../../gimaris.html">GiMaRIS</a> &raquo;</li>
    
        <li><a href="../../index.html">SETLyze 1.0 documentation</a> &raquo;</li>

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for setlyze.report</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c">#  Copyright 2010, 2011, GiMaRIS &lt;info@gimaris.com&gt;</span>
<span class="c">#</span>
<span class="c">#  This file is part of SETLyze - A tool for analyzing the settlement</span>
<span class="c">#  of species on SETL plates.</span>
<span class="c">#</span>
<span class="c">#  SETLyze is free software: you can redistribute it and/or modify</span>
<span class="c">#  it under the terms of the GNU General Public License as published by</span>
<span class="c">#  the Free Software Foundation, either version 3 of the License, or</span>
<span class="c">#  (at your option) any later version.</span>
<span class="c">#</span>
<span class="c">#  SETLyze is distributed in the hope that it will be useful,</span>
<span class="c">#  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c">#  GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c">#  You should have received a copy of the GNU General Public License</span>
<span class="c">#  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;This module provides functions for generating analysis reports.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">sqlite3</span> <span class="kn">import</span> <span class="n">dbapi2</span> <span class="k">as</span> <span class="n">sqlite</span>

<span class="kn">import</span> <span class="nn">setlyze.config</span>
<span class="kn">from</span> <span class="nn">setlyze.std</span> <span class="kn">import</span> <span class="n">make_remarks</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Serrano Pereira&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s">&quot;Copyright 2010, 2011, GiMaRIS&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;GPL3&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;1.0&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s">&quot;Serrano Pereira&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s">&quot;serrano.pereira@gmail.com&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s">&quot;Production&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s">&quot;2013/02/26&quot;</span>

<div class="viewcode-block" id="export"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.export">[docs]</a><span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Export the data from a :class:`Report` object `report` to a data file.</span>

<span class="sd">    The file is saved to `path` in a format specified by `type`. The following</span>
<span class="sd">    values for `type` are currently supported:</span>

<span class="sd">        * ``rst`` (reStructuredText)</span>

<span class="sd">    Design Part: 1.17</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&#39;rst&#39;</span><span class="p">:</span>
        <span class="c"># Add the extension if it&#39;s missing from the filename.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.rst&quot;</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">+=</span> <span class="s">&quot;.rst&quot;</span>
        <span class="n">exporter</span> <span class="o">=</span> <span class="n">ExportRstReport</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
        <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unsupported file type specified.&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Analysis report saved to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Report"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report">[docs]</a><span class="k">class</span> <span class="nc">Report</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a report object.</span>

<span class="sd">    The results for an analysis are saved to an instance of this class using</span>
<span class="sd">    the set methods. An instance of this class is passed to an instance of</span>
<span class="sd">    :class:`setlyze.gui.Report` to display the results graphically.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span> <span class="o">=</span> <span class="n">setlyze</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;db-file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definitions</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="Report.is_empty"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.is_empty">[docs]</a>    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if this is an empty report.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span> <span class="o">==</span> <span class="p">{}</span>
</div>
<div class="viewcode-block" id="Report.set_option"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_option">[docs]</a>    <span class="k">def</span> <span class="nf">set_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set an analysis option `name` to value `value`.</span>

<span class="sd">        This can be used for things like alpha level and the number of repeats</span>
<span class="sd">        for the analysis. They will appear in exported reports.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="Report.set_definitions"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_definitions">[docs]</a>    <span class="k">def</span> <span class="nf">set_definitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definitions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the definitions dictionary `definitions`.</span>

<span class="sd">        This is used to print a definition list in the report.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definitions</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">definitions</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Report.get_option"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.get_option">[docs]</a>    <span class="k">def</span> <span class="nf">get_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value for an analysis option `name`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Report.set_analysis"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">set_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the analysis name to `name`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_name</span> <span class="o">=</span> <span class="n">name</span>
</div>
<div class="viewcode-block" id="Report.set_location_selections"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_location_selections">[docs]</a>    <span class="k">def</span> <span class="nf">set_location_selections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selections</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the locations selections.</span>

<span class="sd">        This element will be filled with the locations selections `selections`,</span>
<span class="sd">        a list with location ID lists (e.g. [[1,2], ..., [3]]).</span>

<span class="sd">        The selections will be saved as follows: ::</span>

<span class="sd">            self.locations_selections = [</span>
<span class="sd">                {</span>
<span class="sd">                    1: {&#39;nr&#39;:100, &#39;name&#39;:&quot;Location A&quot;},</span>
<span class="sd">                    2: {&#39;nr&#39;:200, &#39;name&#39;:&quot;Location B&quot;},</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">                {</span>
<span class="sd">                    3: {&#39;nr&#39;:300, &#39;name&#39;:&quot;Location C&quot;},</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locations_selections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">continue</span>

            <span class="c"># Fetch all information about the locations selection.</span>
            <span class="n">selection_str</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">])</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="s">&quot;SELECT loc_id,loc_nr,loc_name &quot;</span>
                            <span class="s">&quot;FROM localities &quot;</span>
                            <span class="s">&quot;WHERE loc_id IN (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="n">selection_str</span><span class="p">)</span>
                            <span class="p">)</span>

            <span class="c"># Create a dictionary for the selection.</span>
            <span class="n">selection_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">loc_id</span><span class="p">,</span><span class="n">loc_nr</span><span class="p">,</span><span class="n">loc_name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">selection_dict</span><span class="p">[</span><span class="n">loc_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;nr&#39;</span><span class="p">:</span><span class="n">loc_nr</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="n">loc_name</span><span class="p">}</span>

            <span class="c"># Add the selection to the main variable.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locations_selections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selection_dict</span><span class="p">)</span>

        <span class="c"># Close connection with the local database.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Report.set_species_selections"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_species_selections">[docs]</a>    <span class="k">def</span> <span class="nf">set_species_selections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selections</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the species selections.</span>

<span class="sd">        This element will be filled with the species selections `selections`,</span>
<span class="sd">        a list with location ID lists (e.g. [[1,2], ..., [3]]).</span>

<span class="sd">        The selections will be saved as follows: ::</span>

<span class="sd">            self.species_selections = [</span>
<span class="sd">                {</span>
<span class="sd">                    1: {&#39;name_latin&#39;:&quot;Ectopleura larynx&quot;, &#39;name_common&#39;:&quot;Gorgelpijp&quot;},</span>
<span class="sd">                    2: {&#39;name_latin&#39;:&quot;Metridium senile&quot;, &#39;name_common&#39;:&quot;Zeeanjelier&quot;},</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">                {</span>
<span class="sd">                    3: {&#39;name_latin&#39;:&quot;Balanus improvisus&quot;, &#39;name_common&#39;:&quot;Brakwaterpok&quot;},</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">species_selections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="k">continue</span>

            <span class="c"># Allow an integer to be passed, meaning that just one species was</span>
            <span class="c"># selected. But we have to put it in a list in order to work with</span>
            <span class="c"># it.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">selection</span> <span class="o">=</span> <span class="p">[</span><span class="n">selection</span><span class="p">]</span>

            <span class="c"># Fetch all information about the locations selection.</span>
            <span class="n">selection_str</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">])</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="s">&quot;SELECT spe_id,spe_name_latin,spe_name_venacular &quot;</span>
                            <span class="s">&quot;FROM species &quot;</span>
                            <span class="s">&quot;WHERE spe_id IN (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="n">selection_str</span><span class="p">)</span>
                            <span class="p">)</span>

            <span class="c"># Create a dictionary for the selection.</span>
            <span class="n">selection_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">spe_id</span><span class="p">,</span><span class="n">name_latin</span><span class="p">,</span><span class="n">name_common</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">selection_dict</span><span class="p">[</span><span class="n">spe_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name_latin&#39;</span><span class="p">:</span><span class="n">name_latin</span><span class="p">,</span> <span class="s">&#39;name_common&#39;</span><span class="p">:</span><span class="n">name_common</span><span class="p">}</span>

            <span class="c"># Add the selection to the main variable.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_selections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selection_dict</span><span class="p">)</span>

        <span class="c"># Close connection with the local database.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Report.set_spot_distances_observed"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_spot_distances_observed">[docs]</a>    <span class="k">def</span> <span class="nf">set_spot_distances_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the observed spot distances.</span>

<span class="sd">        This element will be filled with the observed spot distances.</span>

<span class="sd">        The spot distances will be saved as follows ::</span>

<span class="sd">            self.spot_distances_observed = {</span>
<span class="sd">                63: [1.0, 2.0, ...],</span>
<span class="sd">                229: [3.16, ...],</span>
<span class="sd">                ...</span>
<span class="sd">            }</span>

<span class="sd">        Where the dictionary keys are plate numbers and the values are lists</span>
<span class="sd">        with distances for the corresponding plates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="c"># Fetch all the observed distances.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="s">&quot;SELECT rec_pla_id,distance &quot;</span>
                        <span class="s">&quot;FROM spot_distances_observed&quot;</span>
                        <span class="p">)</span>

        <span class="c"># Populate the main variable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spot_distances_observed</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pla_id</span><span class="p">,</span><span class="n">distance</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pla_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spot_distances_observed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spot_distances_observed</span><span class="p">[</span><span class="n">pla_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spot_distances_observed</span><span class="p">[</span><span class="n">pla_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">distance</span><span class="p">]</span>

        <span class="c"># Close connection with the local database.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Report.set_spot_distances_expected"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_spot_distances_expected">[docs]</a>    <span class="k">def</span> <span class="nf">set_spot_distances_expected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the expected spot distances.</span>

<span class="sd">        This element will be filled with the expected spot distances.</span>

<span class="sd">        The spot distances will be saved as follows ::</span>

<span class="sd">            self.spot_distances_expected = {</span>
<span class="sd">                63: [1.0, 3.16, ...],</span>
<span class="sd">                229: [4.47, ...],</span>
<span class="sd">                ...</span>
<span class="sd">            }</span>

<span class="sd">        Where the dictionary keys are plate numbers and the values are lists</span>
<span class="sd">        with distances for the corresponding plates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="c"># Fetch all the expected distances.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="s">&quot;SELECT rec_pla_id,distance &quot;</span>
                        <span class="s">&quot;FROM spot_distances_expected&quot;</span>
                        <span class="p">)</span>

        <span class="c"># Populate the main variable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spot_distances_expected</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pla_id</span><span class="p">,</span><span class="n">distance</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pla_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spot_distances_expected</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spot_distances_expected</span><span class="p">[</span><span class="n">pla_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spot_distances_expected</span><span class="p">[</span><span class="n">pla_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">distance</span><span class="p">]</span>

        <span class="c"># Close connection with the local database.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Report.set_plate_areas_definition"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_plate_areas_definition">[docs]</a>    <span class="k">def</span> <span class="nf">set_plate_areas_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the plate areas definition `definition`.</span>

<span class="sd">        Examples of `definition` ::</span>

<span class="sd">            {</span>
<span class="sd">                &#39;area1&#39;: [&#39;A&#39;],</span>
<span class="sd">                &#39;area2&#39;: [&#39;B&#39;],</span>
<span class="sd">                &#39;area3&#39;: [&#39;C&#39;],</span>
<span class="sd">                &#39;area3&#39;: [&#39;D&#39;]</span>
<span class="sd">            }</span>

<span class="sd">            {</span>
<span class="sd">                &#39;area1&#39;: [&#39;A&#39;],</span>
<span class="sd">                &#39;area2&#39;: [&#39;B&#39;],</span>
<span class="sd">                &#39;area3&#39;: [&#39;C&#39;, &#39;D&#39;]</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plate_areas_definition</span> <span class="o">=</span> <span class="n">definition</span>
</div>
<div class="viewcode-block" id="Report.set_area_totals_observed"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_area_totals_observed">[docs]</a>    <span class="k">def</span> <span class="nf">set_area_totals_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">totals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the observed plate area totals.</span>


<span class="sd">        Examples of `totals` ::</span>

<span class="sd">            {</span>
<span class="sd">                &#39;area1&#39;: 261,</span>
<span class="sd">                &#39;area2&#39;: 943,</span>
<span class="sd">                &#39;area3&#39;: 2837,</span>
<span class="sd">                &#39;area4&#39;: 1858,</span>
<span class="sd">            }</span>

<span class="sd">            {</span>
<span class="sd">                &#39;area1&#39;: 261,</span>
<span class="sd">                &#39;area2&#39;: 943,</span>
<span class="sd">                &#39;area3&#39;: 2837,</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_totals_observed</span> <span class="o">=</span> <span class="n">totals</span>
</div>
<div class="viewcode-block" id="Report.set_area_totals_expected"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_area_totals_expected">[docs]</a>    <span class="k">def</span> <span class="nf">set_area_totals_expected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">totals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the expected plate area totals.</span>


<span class="sd">        Examples of `totals` ::</span>

<span class="sd">            {</span>
<span class="sd">                &#39;area1&#39;: 235.96,</span>
<span class="sd">                &#39;area2&#39;: 943.84,</span>
<span class="sd">                &#39;area3&#39;: 2831.52,</span>
<span class="sd">                &#39;area4&#39;: 1887.68,</span>
<span class="sd">            }</span>

<span class="sd">            {</span>
<span class="sd">                &#39;area1&#39;: 235.96,</span>
<span class="sd">                &#39;area2&#39;: 943.84,</span>
<span class="sd">                &#39;area3&#39;: 2831.52,</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_totals_expected</span> <span class="o">=</span> <span class="n">totals</span>
</div>
<div class="viewcode-block" id="Report.set_statistics"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.Report.set_statistics">[docs]</a>    <span class="k">def</span> <span class="nf">set_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set statistics results `data` under key `name` in self.statistics.</span>

<span class="sd">        This method is used to save results from statistical tests. The results</span>
<span class="sd">        must be supplied with the `data` argument. The `data` argument is a</span>
<span class="sd">        list containing dictionaries in the format</span>
<span class="sd">        {&#39;attr&#39;: {&#39;&lt;key&gt;&#39;: &lt;value&gt;, ...}, &#39;results&#39;: {&#39;&lt;key&gt;&#39;: &lt;value&gt;, ...}}</span>
<span class="sd">        where the value for &#39;attr&#39; is a dictionary with the attributes for the</span>
<span class="sd">        test and &#39;results&#39; is a dictionary with elements of the results.</span>

<span class="sd">        If the &#39;attr&#39; key is not set in `data` (or equals None/False), the</span>
<span class="sd">        results are assumed to be absent/incomplete, and the results are not</span>
<span class="sd">        stored.</span>

<span class="sd">        The value for ``data[&#39;attr&#39;][&#39;groups&#39;]`` tells what the dictionary keys</span>
<span class="sd">        for ``data[&#39;results&#39;]`` represent. Possible groups are ``areas`` for</span>
<span class="sd">        plate areas, ``spots`` for total positive spots, and ``ratios`` for</span>
<span class="sd">        total positive spots ratio groups. If ``data[&#39;attr&#39;][&#39;groups&#39;]`` is not</span>
<span class="sd">        set, there are no groups, meaning that the ``data[&#39;results&#39;]``</span>
<span class="sd">        dictionary contains results for a single statistical test.</span>

<span class="sd">        Example of `data` without groups ::</span>

<span class="sd">            {</span>
<span class="sd">                &#39;attr&#39;: {</span>
<span class="sd">                    &#39;method&#39;: &quot;Chi-squared test for given probabilities&quot;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;results&#39;: {</span>
<span class="sd">                    &#39;df&#39;: 3.0,</span>
<span class="sd">                    &#39;p_value&#39;: 0.37,</span>
<span class="sd">                    &#39;chi_squared&#39;: 3.13</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Examples of `data` with groups ::</span>

<span class="sd">            {</span>
<span class="sd">                &#39;attr&#39;: {</span>
<span class="sd">                    &#39;method&#39;: &quot;Chi-squared test for given probabilities&quot;,</span>
<span class="sd">                    &#39;groups&#39;: &quot;ratios&quot;,</span>
<span class="sd">                },</span>
<span class="sd">                &#39;results&#39;: {</span>
<span class="sd">                    1: {</span>
<span class="sd">                        &#39;n_plates&#39;: 2,</span>
<span class="sd">                        &#39;n_distances&#39;: 56,</span>
<span class="sd">                        &#39;df&#39;: 14.0,</span>
<span class="sd">                        &#39;p_value&#39;: 0.90,</span>
<span class="sd">                        &#39;chi_squared&#39;: 7.75,</span>
<span class="sd">                        &#39;mean_expected&#39;: 2.77,</span>
<span class="sd">                        &#39;mean_observed&#39;: 2.50</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">            {</span>
<span class="sd">                &#39;attr&#39;: {</span>
<span class="sd">                    &#39;method&#39;: &quot;Wilcoxon rank sum test with continuity correction&quot;,</span>
<span class="sd">                    &#39;alternative&#39;: &quot;two.sided&quot;,</span>
<span class="sd">                    &#39;conf_level&#39;: 0.95,</span>
<span class="sd">                    &#39;paired&#39;: False,</span>
<span class="sd">                    &#39;groups&#39;: &quot;areas&quot;,</span>
<span class="sd">                },</span>
<span class="sd">                &#39;results&#39;: {</span>
<span class="sd">                    &#39;A&#39;: {&#39;p_value&#39;: 0.67, &#39;mean_expected&#39;: 1.33, &#39;mean_observed&#39;: 1.35},</span>
<span class="sd">                    &#39;B&#39;: {&#39;p_value&#39;: 0.97, &#39;mean_expected&#39;: 4.08, &#39;mean_observed&#39;: 4.07},</span>
<span class="sd">                    &#39;A+B&#39;: {&#39;p_value&#39;: 0.97, &#39;mean_expected&#39;: 2.70, &#39;mean_observed&#39;: 2.71},</span>
<span class="sd">                    ...</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Of repeated tests ::</span>

<span class="sd">            {</span>
<span class="sd">                &#39;attr&#39;: {</span>
<span class="sd">                    &#39;method&#39;: &quot;Wilcoxon rank sum test with continuity correction&quot;,</span>
<span class="sd">                    &#39;groups&#39;: &quot;areas&quot;,</span>
<span class="sd">                    &#39;alpha_level&#39;: 0.05,</span>
<span class="sd">                    &#39;repeats&#39;: 10,</span>
<span class="sd">                },</span>
<span class="sd">                &#39;results&#39;: {</span>
<span class="sd">                    &#39;A&#39;: {&#39;n_significant&#39;: 10, &#39;n_preference&#39;: 10, &#39;n_rejection&#39;: 0},</span>
<span class="sd">                    &#39;B&#39;: {&#39;n_significant&#39;: 1, &#39;n_preference&#39;: 0, &#39;n_rejection&#39;: 1},</span>
<span class="sd">                    &#39;A+B&#39;: {&#39;n_significant&#39;: 9, &#39;n_preference&#39;: 9, &#39;n_rejection&#39;: 0},</span>
<span class="sd">                    ...</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">            {</span>
<span class="sd">                &#39;attr&#39;: {</span>
<span class="sd">                    &#39;method&#39;: &quot;Wilcoxon rank sum test with continuity correction&quot;,</span>
<span class="sd">                    &#39;groups&#39;: &quot;spots|ratios&quot;,</span>
<span class="sd">                    &#39;alpha_level&#39;: 0.05,</span>
<span class="sd">                    &#39;repeats&#39;: 10,</span>
<span class="sd">                },</span>
<span class="sd">                &#39;results&#39;: {</span>
<span class="sd">                    2: {&#39;n_significant&#39;: 10, &#39;n_attraction&#39;: 10, &#39;n_repulsion&#39;: 0},</span>
<span class="sd">                    3: {&#39;n_significant&#39;: 1, &#39;n_attraction&#39;: 0, &#39;n_repulsion&#39;: 1},</span>
<span class="sd">                    ...</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;attr&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
</div></div>
<div class="viewcode-block" id="ExportRstReport"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport">[docs]</a><span class="k">class</span> <span class="nc">ExportRstReport</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Export an analysis report in reStructuredText format.</span>

<span class="sd">    The input is a :class:`Report` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predefined_col_widths</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;df&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="s">&quot;Remarks&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
            <span class="s">&quot;Species&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s">&quot;Species A&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s">&quot;Species B&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s">&quot;W&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predefined_fields</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;Plate Area&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span><span class="p">,</span>
            <span class="s">&quot;Area ID&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span><span class="p">,</span>
            <span class="s">&quot;P-value&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">.4f&quot;</span><span class="p">,</span>
            <span class="s">&quot;Chi squared&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">.4f&quot;</span><span class="p">,</span>
            <span class="s">&quot;Plate Area&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span><span class="p">,</span>
            <span class="s">&quot;Plate Area Surfaces&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span><span class="p">,</span>
            <span class="s">&quot;Mean Observed&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">.4f&quot;</span><span class="p">,</span>
            <span class="s">&quot;Mean Expected&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%%d</span><span class="s">.4f&quot;</span><span class="p">,</span>
            <span class="s">&quot;Remarks&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span><span class="p">,</span>
            <span class="s">&quot;Species&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span><span class="p">,</span>
            <span class="s">&quot;Species A&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span><span class="p">,</span>
            <span class="s">&quot;Species B&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span><span class="p">,</span>
        <span class="p">}</span>

<div class="viewcode-block" id="ExportRstReport.set_report"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.set_report">[docs]</a>    <span class="k">def</span> <span class="nf">set_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the report object `report`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">setlyze</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">Report</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">=</span> <span class="n">report</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Report must be an instance of setlyze.report.Report&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExportRstReport.part"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.part">[docs]</a>    <span class="k">def</span> <span class="nf">part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return `header` marked up as a header for parts in</span>
<span class="sd">        reStructuredText format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&lt;hr&gt;</span><span class="se">\n</span><span class="s">&lt;h&gt;</span><span class="se">\n</span><span class="s">&lt;hr&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;h&gt;&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;hr&gt;&#39;</span><span class="p">,</span> <span class="s">&quot;=&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">text</span>
</div>
<div class="viewcode-block" id="ExportRstReport.chapter"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.chapter">[docs]</a>    <span class="k">def</span> <span class="nf">chapter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return `header` marked up as a header for parts in</span>
<span class="sd">        reStructuredText format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&lt;hr&gt;</span><span class="se">\n</span><span class="s">&lt;h&gt;</span><span class="se">\n</span><span class="s">&lt;hr&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;h&gt;&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;hr&gt;&#39;</span><span class="p">,</span> <span class="s">&quot;*&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">text</span>
</div>
<div class="viewcode-block" id="ExportRstReport.section"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.section">[docs]</a>    <span class="k">def</span> <span class="nf">section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return `header` marked up as a header for sections in</span>
<span class="sd">        reStructuredText format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&lt;h&gt;</span><span class="se">\n</span><span class="s">&lt;hr&gt;</span><span class="se">\n\n</span><span class="s">&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;h&gt;&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;hr&gt;&#39;</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">text</span>
</div>
<div class="viewcode-block" id="ExportRstReport.subsection"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.subsection">[docs]</a>    <span class="k">def</span> <span class="nf">subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return `header` marked up as a header for subsections in</span>
<span class="sd">        reStructuredText format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&lt;h&gt;</span><span class="se">\n</span><span class="s">&lt;hr&gt;</span><span class="se">\n\n</span><span class="s">&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;h&gt;&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;hr&gt;&#39;</span><span class="p">,</span> <span class="s">&quot;=&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">text</span>
</div>
<div class="viewcode-block" id="ExportRstReport.subsubsection"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.subsubsection">[docs]</a>    <span class="k">def</span> <span class="nf">subsubsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return `header` marked up as a header for subsubsections in</span>
<span class="sd">        reStructuredText format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&lt;h&gt;</span><span class="se">\n</span><span class="s">&lt;hr&gt;</span><span class="se">\n\n</span><span class="s">&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;h&gt;&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;hr&gt;&#39;</span><span class="p">,</span> <span class="s">&quot;^&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">text</span>
</div>
<div class="viewcode-block" id="ExportRstReport.deflist"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.deflist">[docs]</a>    <span class="k">def</span> <span class="nf">deflist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definitions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a definition list from the dictionary `definitions`.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;Definitions&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">definition</span> <span class="ow">in</span> <span class="n">definitions</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">term</span><span class="p">,</span><span class="n">definition</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExportRstReport.table"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.table">[docs]</a>    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">mincolwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a table header with column names from `headers` in</span>
<span class="sd">        reStructuredText format.</span>

<span class="sd">        `headers` is a list of strings representing the column names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">header_lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">header_placeholders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">row_placeholders</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Generate a placeholder strings for the column names and the fields.</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predefined_col_widths</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predefined_col_widths</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">mincolwidth</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">mincolwidth</span>

            <span class="c"># Save the lengths of all column names. This is needed for</span>
            <span class="c"># generating the table rules.</span>
            <span class="n">header_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

            <span class="c"># Construct the placeholders for the column names.</span>
            <span class="n">header_placeholders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">length</span><span class="p">)</span>

            <span class="c"># Construct the placeholders for the fields.</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predefined_fields</span><span class="p">:</span>
                <span class="n">row_placeholders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%%%d</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">length</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row_placeholders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predefined_fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">%</span> <span class="n">length</span><span class="p">)</span>

        <span class="c"># Generate top rule for table.</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_rule</span><span class="p">(</span><span class="n">header_lengths</span><span class="p">)</span>

        <span class="c"># Generate string with column names.</span>
        <span class="n">header_placeholders</span> <span class="o">=</span> <span class="s">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_placeholders</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="n">header_placeholders</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="c"># Generate rule below column names.</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_rule</span><span class="p">(</span><span class="n">header_lengths</span><span class="p">)</span>

        <span class="c"># Generate placeholder string for table rows.</span>
        <span class="n">row_placeholders</span> <span class="o">=</span> <span class="s">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row_placeholders</span><span class="p">)</span>
        <span class="n">row_placeholders</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="c"># Generate rule for the end of the table.</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_rule</span><span class="p">(</span><span class="n">header_lengths</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="n">row_placeholders</span><span class="p">,</span><span class="n">footer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExportRstReport.get_column_widths"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.get_column_widths">[docs]</a>    <span class="k">def</span> <span class="nf">get_column_widths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">mincolwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the column widths for a list of column names.</span>

<span class="sd">        Argument `headers` is a list of strings representing the column names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col_widths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predefined_col_widths</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predefined_col_widths</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">mincolwidth</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">mincolwidth</span>
            <span class="n">col_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">col_widths</span>
</div>
<div class="viewcode-block" id="ExportRstReport.table_span_header"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.table_span_header">[docs]</a>    <span class="k">def</span> <span class="nf">table_span_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_widths</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">spans</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a table header row with main columns spanned headers.</span>

<span class="sd">        Argument `col_widths` is a list of widths for the main table columns,</span>
<span class="sd">        `headers` is a list of column names that need to be spanned over</span>
<span class="sd">        the main columns, `spans` is a list of integers, each integer</span>
<span class="sd">        indicating the number of columns the corresponding column in `headers`</span>
<span class="sd">        should span, hence `headers` and `spans` must have the same number</span>
<span class="sd">        of items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">spans</span><span class="p">),</span> \
            <span class="s">&quot;Length of arguments &#39;headers&#39; and &#39;spans&#39; are not equal.&quot;</span>

        <span class="c"># Calculate the width for each spanned column.</span>
        <span class="n">spanned_col_widths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">last_col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">span</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_widths</span><span class="p">),</span> \
                <span class="s">&quot;Cannot span outside the table boundaries.&quot;</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last_col</span><span class="p">,</span> <span class="n">last_col</span><span class="o">+</span><span class="n">span</span><span class="p">):</span>
                <span class="n">width</span> <span class="o">+=</span> <span class="n">col_widths</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="n">width</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">span</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">spanned_col_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
            <span class="n">last_col</span> <span class="o">+=</span> <span class="n">span</span>

        <span class="c"># Construct the column names row.</span>
        <span class="n">header_row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">spanned_col_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> \
                <span class="p">(</span><span class="s">&quot;The width of a header (</span><span class="si">%s</span><span class="s">) cannot exceed the width &quot;</span>
                <span class="s">&quot;of the spanned column (</span><span class="si">%d</span><span class="s">)&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">spanned_col_widths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s">&#39;..&#39;</span><span class="p">:</span>
                <span class="n">header_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">spanned_col_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">header_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">spanned_col_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">header_str</span> <span class="o">=</span> <span class="s">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_row</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="c"># Construct the column span underlines row.</span>
        <span class="n">header_str</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_rule</span><span class="p">(</span><span class="n">spanned_col_widths</span><span class="p">,</span> <span class="n">char</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">header_str</span>
</div>
<div class="viewcode-block" id="ExportRstReport.table_rule"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.table_rule">[docs]</a>    <span class="k">def</span> <span class="nf">table_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_widths</span><span class="p">,</span> <span class="n">char</span><span class="o">=</span><span class="s">&#39;=&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a rule for a table with column widths `col_widths`.</span>

<span class="sd">        Argument `col_widths` is a list with column widths (integers), and</span>
<span class="sd">        `char` the character used to make rules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">col_widths</span><span class="p">:</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="o">*</span><span class="n">w</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</div>
<div class="viewcode-block" id="ExportRstReport.get_lines"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.get_lines">[docs]</a>    <span class="k">def</span> <span class="nf">get_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the analysis report in reStructuredText format.&quot;&quot;&quot;</span>

        <span class="c"># Title</span>
        <span class="n">analysis_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="s">&#39;analysis_name&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">analysis_name</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">part</span><span class="p">(</span><span class="s">&quot;SETLyze Analysis Report - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">analysis_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">part</span><span class="p">(</span><span class="s">&quot;SETLyze Analysis Report&quot;</span><span class="p">)</span>

        <span class="c"># Info</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_info</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># Locations and species selections</span>
        <span class="n">locations_selections</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="s">&#39;locations_selections&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">species_selections</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="s">&#39;species_selections&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">locations_selections</span> <span class="ow">and</span> <span class="n">species_selections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_selections</span><span class="p">(</span><span class="n">locations_selections</span><span class="p">,</span> <span class="n">species_selections</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># Plate areas definition</span>
        <span class="n">plate_areas_definition</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="s">&#39;plate_areas_definition&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plate_areas_definition</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_plate_areas_definition</span><span class="p">(</span><span class="n">plate_areas_definition</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># Species Totals per Plate Area</span>
        <span class="n">area_totals_observed</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="s">&#39;area_totals_observed&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">area_totals_expected</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="s">&#39;area_totals_expected&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">area_totals_observed</span> <span class="ow">and</span> <span class="n">area_totals_expected</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_area_totals</span><span class="p">(</span><span class="n">area_totals_observed</span><span class="p">,</span><span class="n">area_totals_expected</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># chi_squared_areas</span>
        <span class="n">chi_squared_areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;chi_squared_areas&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">chi_squared_areas</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_chisq_areas</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># wilcoxon_spots</span>
        <span class="n">wilcoxon_spots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wilcoxon_spots&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">wilcoxon_spots</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_wilcoxon_spots</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># wilcoxon_spots_repeats</span>
        <span class="n">wilcoxon_spots_repeats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wilcoxon_spots_repeats&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">wilcoxon_spots_repeats</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_repeats_spots</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># wilcoxon_ratios</span>
        <span class="n">wilcoxon_ratios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wilcoxon_ratios&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">wilcoxon_ratios</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_wilcoxon_ratios</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># wilcoxon_ratios_repeats</span>
        <span class="n">wilcoxon_ratios_repeats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wilcoxon_ratios_repeats&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">wilcoxon_ratios_repeats</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_repeats_ratios</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># wilcoxon_areas</span>
        <span class="n">wilcoxon_areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wilcoxon_areas&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">wilcoxon_areas</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_wilcoxon_areas</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># wilcoxon_areas_repeats</span>
        <span class="n">wilcoxon_areas_repeats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wilcoxon_areas_repeats&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">wilcoxon_areas_repeats</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_repeats_areas</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># chi_squared_spots</span>
        <span class="n">chi_squared_spots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;chi_squared_spots&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">chi_squared_spots</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_chisq_spots</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># chi_squared_ratios</span>
        <span class="n">chi_squared_ratios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;chi_squared_ratios&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">chi_squared_ratios</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_statistics_chisq_ratios</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># plate_areas_summary</span>
        <span class="n">plate_areas_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;plate_areas_summary&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">plate_areas_summary</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_batch_summary</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s">&quot;Spot Preference&quot;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># positive_spots_summary</span>
        <span class="n">positive_spots_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;positive_spots_summary&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">positive_spots_summary</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_batch_summary</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s">&quot;Attraction within Species&quot;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># ratio_groups_summary</span>
        <span class="n">ratio_groups_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ratio_groups_summary&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">ratio_groups_summary</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_batch_summary</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s">&quot;Attraction between Species&quot;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>

        <span class="c"># Print definitions.</span>
        <span class="n">definitions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="s">&#39;definitions&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">definitions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deflist</span><span class="p">(</span><span class="n">definitions</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">line</span>
</div>
    <span class="k">def</span> <span class="nf">add_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toc</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S %z (%a, </span><span class="si">%d</span><span class="s"> %b %Y)&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">yield</span> <span class="s">&quot;:Generator: SETLyze </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">__version__</span><span class="p">)</span>
        <span class="k">yield</span> <span class="s">&quot;:Date: $Date: </span><span class="si">%s</span><span class="s"> $</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s">&quot;:</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="n">toc</span><span class="p">:</span>
            <span class="k">yield</span> <span class="s">&quot;.. contents::</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

    <span class="k">def</span> <span class="nf">add_selections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations_selections</span><span class="p">,</span> <span class="n">species_selections</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;Locations and Species Selections&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">selection</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_selections</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsection</span><span class="p">(</span><span class="s">&quot;Species Selection (</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">spe_id</span><span class="p">,</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="s">&#39;name_latin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="s">&quot;- </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="s">&#39;name_common&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">species</span><span class="p">[</span><span class="s">&#39;name_common&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="s">&quot;- *</span><span class="si">%s</span><span class="s">*</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="s">&#39;name_latin&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="s">&quot;- *</span><span class="si">%s</span><span class="s">* (</span><span class="si">%s</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="s">&#39;name_latin&#39;</span><span class="p">],</span> <span class="n">species</span><span class="p">[</span><span class="s">&#39;name_common&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">selection</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">locations_selections</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsection</span><span class="p">(</span><span class="s">&quot;Locations Selection (</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">loc_id</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s">&quot;- </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">loc</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">add_plate_areas_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;Plate Areas Definition for Chi-squared Test&quot;</span><span class="p">)</span>
        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&quot;Area ID&quot;</span><span class="p">,</span><span class="s">&quot;Plate Area Surfaces&quot;</span><span class="p">])</span>
        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">area_id</span><span class="p">,</span> <span class="n">spots</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
            <span class="n">spots</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spots</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span><span class="n">area_id</span><span class="p">,</span> <span class="n">spots</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

    <span class="k">def</span> <span class="nf">add_area_totals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observed</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;Species Totals per Plate Area for Chi-squared Test&quot;</span><span class="p">)</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&quot;Area ID&quot;</span><span class="p">,</span><span class="s">&quot;Observed Totals&quot;</span><span class="p">,</span>
            <span class="s">&quot;Expected Totals&quot;</span><span class="p">])</span>
        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">area_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">observed</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">area_id</span><span class="p">,</span>
                <span class="n">observed</span><span class="p">[</span><span class="n">area_id</span><span class="p">],</span>
                <span class="n">expected</span><span class="p">[</span><span class="n">area_id</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

    <span class="k">def</span> <span class="nf">add_statistics_wilcoxon_spots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Positive Spots&#39;</span><span class="p">,</span><span class="s">&#39;n (plates)&#39;</span><span class="p">,</span>
        <span class="s">&#39;n (distances)&#39;</span><span class="p">,</span><span class="s">&#39;P-value&#39;</span><span class="p">,</span><span class="s">&#39;Mean Observed&#39;</span><span class="p">,</span><span class="s">&#39;Mean Expected&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">positive_spots</span><span class="p">,</span><span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">positive_spots</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_plates&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_values&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;p_value&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_observed&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_expected&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">(table continued)</span><span class="se">\n\n</span><span class="s">&quot;</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Positive Spots&#39;</span><span class="p">,</span><span class="s">&#39;Remarks&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">positive_spots</span><span class="p">,</span><span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">positive_spots</span><span class="p">,</span>
                <span class="n">make_remarks</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

    <span class="k">def</span> <span class="nf">add_statistics_wilcoxon_ratios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Ratio Group&#39;</span><span class="p">,</span><span class="s">&#39;n (plates)&#39;</span><span class="p">,</span>
            <span class="s">&#39;n (distances)&#39;</span><span class="p">,</span><span class="s">&#39;P-value&#39;</span><span class="p">,</span><span class="s">&#39;Mean Observed&#39;</span><span class="p">,</span><span class="s">&#39;Mean Expected&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">ratio_group</span><span class="p">,</span><span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">ratio_group</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_plates&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_values&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;p_value&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_observed&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_expected&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">(table continued)</span><span class="se">\n\n</span><span class="s">&quot;</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Ratio Group&#39;</span><span class="p">,</span><span class="s">&#39;Remarks&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">ratio_group</span><span class="p">,</span><span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">ratio_group</span><span class="p">,</span>
                <span class="n">make_remarks</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

<div class="viewcode-block" id="ExportRstReport.add_statistics_wilcoxon_areas"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.add_statistics_wilcoxon_areas">[docs]</a>    <span class="k">def</span> <span class="nf">add_statistics_wilcoxon_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the statistic results to the report dialog.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Plate Area&#39;</span><span class="p">,</span><span class="s">&#39;n (totals)&#39;</span><span class="p">,</span>
            <span class="s">&#39;n (observed species)&#39;</span><span class="p">,</span> <span class="s">&#39;n (expected species)&#39;</span><span class="p">,</span> <span class="s">&#39;P-value&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">area</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">area</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_values&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_sp_observed&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_sp_expected&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;p_value&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">(table continued)</span><span class="se">\n\n</span><span class="s">&quot;</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Plate Area&#39;</span><span class="p">,</span><span class="s">&#39;Mean Observed&#39;</span><span class="p">,</span>
            <span class="s">&#39;Mean Expected&#39;</span><span class="p">,</span><span class="s">&#39;Remarks&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">area</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">area</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_observed&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_expected&#39;</span><span class="p">],</span>
                <span class="n">make_remarks</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>
</div>
    <span class="k">def</span> <span class="nf">add_statistics_chisq_spots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Positive Spots&#39;</span><span class="p">,</span><span class="s">&#39;n (plates)&#39;</span><span class="p">,</span>
        <span class="s">&#39;n (distances)&#39;</span><span class="p">,</span><span class="s">&#39;P-value&#39;</span><span class="p">,</span><span class="s">&#39;Chi squared&#39;</span><span class="p">,</span><span class="s">&#39;df&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">positive_spots</span><span class="p">,</span><span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">positive_spots</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_plates&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_values&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;p_value&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;chi_squared&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">(table continued)</span><span class="se">\n\n</span><span class="s">&quot;</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Positive Spots&#39;</span><span class="p">,</span><span class="s">&#39;Mean Observed&#39;</span><span class="p">,</span>
            <span class="s">&#39;Mean Expected&#39;</span><span class="p">,</span><span class="s">&#39;Remarks&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">positive_spots</span><span class="p">,</span><span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">positive_spots</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_observed&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_expected&#39;</span><span class="p">],</span>
                <span class="n">make_remarks</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

    <span class="k">def</span> <span class="nf">add_statistics_chisq_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;P-value&#39;</span><span class="p">,</span><span class="s">&#39;Chi squared&#39;</span><span class="p">,</span><span class="s">&#39;df&#39;</span><span class="p">,</span>
            <span class="s">&#39;Remarks&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">][</span><span class="s">&#39;p_value&#39;</span><span class="p">],</span>
            <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">][</span><span class="s">&#39;chi_squared&#39;</span><span class="p">],</span>
            <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">][</span><span class="s">&#39;df&#39;</span><span class="p">],</span>
            <span class="n">make_remarks</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">],</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

    <span class="k">def</span> <span class="nf">add_statistics_chisq_ratios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">((</span><span class="s">&#39;Ratio Group&#39;</span><span class="p">,</span><span class="s">&#39;n (plates)&#39;</span><span class="p">,</span>
            <span class="s">&#39;n (distances)&#39;</span><span class="p">,</span><span class="s">&#39;P-value&#39;</span><span class="p">,</span><span class="s">&#39;Chi squared&#39;</span><span class="p">,</span><span class="s">&#39;df&#39;</span><span class="p">))</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">ratio_group</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">ratio_group</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_plates&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_values&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;p_value&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;chi_squared&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">(table continued)</span><span class="se">\n\n</span><span class="s">&quot;</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Ratio Group&#39;</span><span class="p">,</span><span class="s">&#39;Mean Observed&#39;</span><span class="p">,</span>
            <span class="s">&#39;Mean Expected&#39;</span><span class="p">,</span><span class="s">&#39;Remarks&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">ratio_group</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">ratio_group</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_observed&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;mean_expected&#39;</span><span class="p">],</span>
                <span class="n">make_remarks</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">]),</span>
                <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

    <span class="k">def</span> <span class="nf">add_statistics_repeats_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> (repeated)&quot;</span> <span class="o">%</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Plate Area&#39;</span><span class="p">,</span><span class="s">&#39;n (totals)&#39;</span><span class="p">,</span>
            <span class="s">&#39;n (observed species)&#39;</span><span class="p">,</span><span class="s">&#39;n (significant)&#39;</span><span class="p">,</span>
            <span class="s">&#39;n (non-significant)&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">plate_area</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">plate_area</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_values&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_sp_observed&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_significant&#39;</span><span class="p">],</span>
                <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;repeats&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_significant&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">(table continued)</span><span class="se">\n\n</span><span class="s">&quot;</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Plate Area&#39;</span><span class="p">,</span><span class="s">&#39;n (preference)&#39;</span><span class="p">,</span>
            <span class="s">&#39;n (rejection)&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">plate_area</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">plate_area</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_preference&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_rejection&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

    <span class="k">def</span> <span class="nf">add_statistics_repeats_spots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> (repeated)&quot;</span> <span class="o">%</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Positive Spots&#39;</span><span class="p">,</span><span class="s">&#39;n (plates)&#39;</span><span class="p">,</span>
        <span class="s">&#39;n (distances)&#39;</span><span class="p">,</span><span class="s">&#39;n (significant)&#39;</span><span class="p">,</span><span class="s">&#39;n (non-significant)&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">positive_spots</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">positive_spots</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_plates&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_values&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_significant&#39;</span><span class="p">],</span>
                <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;repeats&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_significant&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">(table continued)</span><span class="se">\n\n</span><span class="s">&quot;</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Positive Spots&#39;</span><span class="p">,</span><span class="s">&#39;n (attraction)&#39;</span><span class="p">,</span>
            <span class="s">&#39;n (repulsion)&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">positive_spots</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">positive_spots</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_attraction&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_repulsion&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

    <span class="k">def</span> <span class="nf">add_statistics_repeats_ratios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> (repeated)&quot;</span> <span class="o">%</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;method&#39;</span><span class="p">])</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Ratio Group&#39;</span><span class="p">,</span><span class="s">&#39;n (plates)&#39;</span><span class="p">,</span>
        <span class="s">&#39;n (distances)&#39;</span><span class="p">,</span><span class="s">&#39;n (significant)&#39;</span><span class="p">,</span><span class="s">&#39;n (non-significant)&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">ratio_group</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">ratio_group</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_plates&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_values&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_significant&#39;</span><span class="p">],</span>
                <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;repeats&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_significant&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

        <span class="k">yield</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">(table continued)</span><span class="se">\n\n</span><span class="s">&quot;</span>

        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">([</span><span class="s">&#39;Ratio Group&#39;</span><span class="p">,</span><span class="s">&#39;n (attraction)&#39;</span><span class="p">,</span>
            <span class="s">&#39;n (repulsion)&#39;</span><span class="p">])</span>

        <span class="k">yield</span> <span class="n">t_header</span>
        <span class="k">for</span> <span class="n">ratio_group</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">ratio_group</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_attraction&#39;</span><span class="p">],</span>
                <span class="n">stats</span><span class="p">[</span><span class="s">&#39;n_repulsion&#39;</span><span class="p">],</span>
                <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_footer</span>

<div class="viewcode-block" id="ExportRstReport.add_batch_summary"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.add_batch_summary">[docs]</a>    <span class="k">def</span> <span class="nf">add_batch_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistics</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a batch summary report.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;Batch summary - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">title</span><span class="p">)</span>
        <span class="n">t_header</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;columns&#39;</span><span class="p">],</span> <span class="n">mincolwidth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="c"># Figure out which columns display species names.</span>
        <span class="n">species_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;columns&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s">&quot;Species&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">species_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="c"># Return a complicated table header consisting of two rows and cells</span>
        <span class="c"># that span multiple rows. Used instead of the simple `t_header`.</span>
        <span class="n">col_widths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column_widths</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;columns&#39;</span><span class="p">],</span> <span class="n">mincolwidth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_rule</span><span class="p">(</span><span class="n">col_widths</span><span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_span_header</span><span class="p">(</span><span class="n">col_widths</span><span class="p">,</span>
            <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;columns_over&#39;</span><span class="p">],</span>
            <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;columns_over_spans&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;attr&#39;</span><span class="p">][</span><span class="s">&#39;columns&#39;</span><span class="p">])</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_rule</span><span class="p">(</span><span class="n">col_widths</span><span class="p">)</span>

        <span class="c"># Return the data rows.</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">statistics</span><span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">]:</span>
            <span class="n">c_row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">c_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="n">c_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;ns&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">c_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;na&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">species_cols</span><span class="p">:</span>
                    <span class="n">c_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;*</span><span class="si">%s</span><span class="s">*&quot;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">t_row</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">c_row</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">t_row</span>
                <span class="k">print</span> <span class="n">c_row</span>
        <span class="k">yield</span> <span class="n">t_footer</span>
</div>
<div class="viewcode-block" id="ExportRstReport.export"><a class="viewcode-back" href="../../setlyze/report.html#setlyze.report.ExportRstReport.export">[docs]</a>    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate and export the report to a file.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lines</span><span class="p">())</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/setlyze-logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    <li><a href="../../gimaris.html">GiMaRIS</a> &raquo;</li>
    
        <li><a href="../../index.html">SETLyze 1.0 documentation</a> &raquo;</li>

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, 2011, GiMaRIS.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>