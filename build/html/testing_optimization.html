

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Testing and Optimization &mdash; SETLyze v0.1.1 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="SETLyze v0.1.1 documentation" href="index.html" />
    <link rel="up" title="SETLyze Developer Guide" href="developer_guide.html" />
    <link rel="next" title="Distribution of SETLyze" href="distribution.html" />
    <link rel="prev" title="setlyze.analysis.spot_preference — Analysis 1, Spot preference" href="setlyze/analysis/spot_preference.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="distribution.html" title="Distribution of SETLyze"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="setlyze/analysis/spot_preference.html" title="setlyze.analysis.spot_preference — Analysis 1, Spot preference"
             accesskey="P">previous</a> |</li>
    <li><a href="gimaris.html">GiMaRIS</a> &raquo;</li>
    
        <li><a href="index.html">SETLyze v0.1.1 documentation</a> &raquo;</li>

          <li><a href="developer_guide.html" accesskey="U">SETLyze Developer Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="testing-and-optimization">
<span id="testing-optimization"></span><h1>Testing and Optimization<a class="headerlink" href="#testing-and-optimization" title="Permalink to this headline">¶</a></h1>
<p>This document describes the steps taken to test and optimize SETLyze.</p>
<div class="section" id="testing">
<span id="id1"></span><h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="calculation-of-expected-spot-distances">
<span id="testing-spot-distances"></span><h3>Calculation of expected spot distances<a class="headerlink" href="#calculation-of-expected-spot-distances" title="Permalink to this headline">¶</a></h3>
<p>Analyses 2 and 3 have a built-in consistency check. In all cases must the
number of calculated expected spot distances be equal to the number of observed
spot distances. If this is not the case, than this indicates a bug in the
application. This is what the check looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Perform a consistency check. The number of observed and</span>
<span class="c"># expected spot distances must always be the same.</span>
<span class="n">count_observed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">observed</span><span class="p">)</span>
<span class="n">count_expected</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="k">if</span> <span class="n">count_observed</span> <span class="o">!=</span> <span class="n">count_expected</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Number of observed and expected spot &quot;</span>
        <span class="s">&quot;distances are not equal. This indicates a bug &quot;</span>
        <span class="s">&quot;in the application.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-spot-distances-for-normal-distribution">
<span id="testing-spot-distances-normality"></span><h3>Testing spot distances for normal distribution<a class="headerlink" href="#testing-spot-distances-for-normal-distribution" title="Permalink to this headline">¶</a></h3>
<p>This part describes the method used to test if the spot distances on a
SETL-plate follow a standard normal distribution. The choice of the statistical
tests used for some analyis is based on the results of this test. This is
because some statistical tests assume that the samples follow a normal
distribution while some do not.</p>
<p>First step was to calculate the probabilities for the spot distances on a
SETL-plate. A Python script was written to calculate the probabilities for
all possible spot distances on a single SETL-plate. This was done for both
intra-specific and inter-specific spot distances. The results were then loaded
into R and visualised in a histogram (see <a class="reference internal" href="#fig-distance-distribution-intra"><em>figure 13</em></a>
and <a class="reference internal" href="#fig-distance-distribution-inter"><em>14</em></a>).</p>
<div class="figure align-center" id="fig-distance-distribution-intra">
<a class="reference internal image-reference" href="_images/distance_distribution_intra.png"><img alt="Distribution for intra-specific spot distances" src="_images/distance_distribution_intra.png" style="width: 480.0px; height: 480.0px;" /></a>
<p class="caption">Figure 13. Distribution for intra-specific spot distances. The
frequencies were obtained by calculating all possible distances
between two spots if all 25 spots are covered.
The same test was done with different numbers of positive spots
randomly placed on a plate with 100.000 repeats. All
resulting distributions are very similar to this figure.</p>
</div>
<div class="figure align-center" id="fig-distance-distribution-inter">
<a class="reference internal image-reference" href="_images/distance_distribution_inter.png"><img alt="Distribution for inter-specific spot distances" src="_images/distance_distribution_inter.png" style="width: 480.0px; height: 480.0px;" /></a>
<p class="caption">Figure 14. Distribution for inter-specific spot distances. The
frequencies were obtained by calculating all possible distances
between two spots with ratio 25:25 (species A and B have all 25 spots
covered). The same test was done with different positive spots
ratios (spots randomly placed on a plate, 100.000 repeats). All
resulting distributions are very similar to this figure.</p>
</div>
<p>The histograms show that there is a tendency towards a normal distrubution, but
this is obstructed because of the limited number of possible spot distances.
To test if the distribution of spot distances really don&#8217;t follow a standard
normal distribution, we performed the One-sample Kolmogorov-Smirnov test on
both (intra and inter) spot distance samples. This was again done with the
use of R. The results are as follows:</p>
<div class="highlight-python"><pre>&gt; ks.test(dist_intra[,1], 'pnorm', mean=mean(dist_intra[,1]), sd=sd(dist_intra[,1]))

    One-sample Kolmogorov-Smirnov test

data:  dist_intra[, 1]
D = 0.1419, p-value = 1.133e-05
alternative hypothesis: two-sided

Warning message:
In ks.test(dist_intra[, 1], "pnorm", mean = mean(dist_intra[, 1]),  :
  cannot compute correct p-values with ties

&gt; ks.test(dist_inter[,1], 'pnorm', mean=mean(dist_inter[,1]), sd=sd(dist_inter[,1]))

    One-sample Kolmogorov-Smirnov test

data:  dist_inter[, 1]
D = 0.1188, p-value = 4.403e-08
alternative hypothesis: two-sided

Warning message:
In ks.test(dist_inter[, 1], "pnorm", mean = mean(dist_inter[, 1]),  :
  cannot compute correct p-values with ties</pre>
</div>
<p>So the p-values can&#8217;t be correctly computed which might render the results
unreliable. So the Shapiro-Wilk normality test was performed as well:</p>
<div class="highlight-python"><pre>&gt; shapiro.test(dist_intra[, 1])

    Shapiro-Wilk normality test

data:  dist_intra[, 1]
W = 0.9512, p-value = 1.955e-08

&gt; shapiro.test(dist_inter[, 1])

    Shapiro-Wilk normality test

data:  dist_inter[, 1]
W = 0.9725, p-value = 1.957e-09</pre>
</div>
<p>Again very low p-values are found, which is why we assume that spot distances
on a SETL-plate don&#8217;t follow a standard normal distribution. Hence we chose
the Wilcoxon rank-sum test because this test doesn&#8217;t assume that data come
from a normal distribution (<a class="reference internal" href="references.html#ref-dalgaard"><em>Dalgaard</em></a>). Welch&#8217;s t-test is
an adaptation of Student&#8217;s t-test (<a class="reference internal" href="references.html#ref-welch"><em>Wikipedia</em></a>). And because
Student&#8217;s t-test does assume that data come from a normal distribution
(<a class="reference internal" href="references.html#ref-dalgaard"><em>Dalgaard</em></a>), we chose not to use this test.</p>
</div>
</div>
<div class="section" id="optimization">
<span id="id2"></span><h2>Optimization<a class="headerlink" href="#optimization" title="Permalink to this headline">¶</a></h2>
<div class="section" id="spot-distance-calculation">
<span id="optimization-spot-dist-calc"></span><h3>Spot distance calculation<a class="headerlink" href="#spot-distance-calculation" title="Permalink to this headline">¶</a></h3>
<p>It was thought that retrieving pre-calculating spot distances from a table in
the local database would be faster than calculating each spot distance on run
time. Python&#8217;s <a class="reference external" href="http://docs.python.org/library/timeit.html#module-timeit" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">timeit</span></tt></a> module was used to find out which method is
faster. For this purpose a small script was written:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">from</span> <span class="nn">sqlite3</span> <span class="kn">import</span> <span class="n">dbapi2</span> <span class="k">as</span> <span class="n">sqlite</span>

<span class="kn">import</span> <span class="nn">setlyze.std</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~/.setlyze/setl_local.db&#39;</span><span class="p">))</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">test_record</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">test1</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get pre-calculated spot distances from the local database.&quot;&quot;&quot;</span>
    <span class="n">combos</span> <span class="o">=</span> <span class="n">setlyze</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">get_spot_combinations_from_record</span><span class="p">(</span><span class="n">test_record</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">spot1</span><span class="p">,</span><span class="n">spot2</span> <span class="ow">in</span> <span class="n">combos</span><span class="p">:</span>
        <span class="n">h</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">setlyze</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">get_spot_position_difference</span><span class="p">(</span><span class="n">spot1</span><span class="p">,</span><span class="n">spot2</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="s">&quot;SELECT distance &quot;</span>
                         <span class="s">&quot;FROM spot_distances &quot;</span>
                         <span class="s">&quot;WHERE delta_x = ? &quot;</span>
                         <span class="s">&quot;AND delta_y = ?&quot;</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">test2</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Calculate spot distances on run time.&quot;&quot;&quot;</span>
    <span class="n">combos</span> <span class="o">=</span> <span class="n">setlyze</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">get_spot_combinations_from_record</span><span class="p">(</span><span class="n">test_record</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">spot1</span><span class="p">,</span><span class="n">spot2</span> <span class="ow">in</span> <span class="n">combos</span><span class="p">:</span>
        <span class="n">h</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">setlyze</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">get_spot_position_difference</span><span class="p">(</span><span class="n">spot1</span><span class="p">,</span><span class="n">spot2</span><span class="p">)</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">setlyze</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>

<span class="c"># Time both tests.</span>
<span class="n">runs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s">&quot;test1()&quot;</span><span class="p">,</span> <span class="s">&quot;from __main__ import test1&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;test1: </span><span class="si">%f</span><span class="s"> seconds&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span><span class="o">/</span><span class="n">runs</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s">&quot;test2()&quot;</span><span class="p">,</span> <span class="s">&quot;from __main__ import test2&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;test2: </span><span class="si">%f</span><span class="s"> seconds&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span><span class="o">/</span><span class="n">runs</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The first test in the script gets pre-calculated spot distances from the
database and the second test calculates spot distances on run time. The
output was as follows:</p>
<div class="highlight-python"><pre>test1: 0.011350 seconds
test2: 0.003097 seconds</pre>
</div>
<p>This shows that calculating spot distances on run time is almost 4 times faster
than retrieving pre-calculated spot distances from the database. So the use
of the &#8220;spot_distances&#8221; table was dropped and spot distances are now calculated
on run time.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/setlyze-logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Testing and Optimization</a><ul>
<li><a class="reference internal" href="#testing">Testing</a><ul>
<li><a class="reference internal" href="#calculation-of-expected-spot-distances">Calculation of expected spot distances</a></li>
<li><a class="reference internal" href="#testing-spot-distances-for-normal-distribution">Testing spot distances for normal distribution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimization">Optimization</a><ul>
<li><a class="reference internal" href="#spot-distance-calculation">Spot distance calculation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="setlyze/analysis/spot_preference.html"
                        title="previous chapter"><tt class="docutils literal docutils literal docutils literal"><span class="pre">setlyze.analysis.spot_preference</span></tt> &#8212; Analysis 1, Spot preference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="distribution.html"
                        title="next chapter">Distribution of SETLyze</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/testing_optimization.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="distribution.html" title="Distribution of SETLyze"
             >next</a> |</li>
        <li class="right" >
          <a href="setlyze/analysis/spot_preference.html" title="setlyze.analysis.spot_preference — Analysis 1, Spot preference"
             >previous</a> |</li>
    <li><a href="gimaris.html">GiMaRIS</a> &raquo;</li>
    
        <li><a href="index.html">SETLyze v0.1.1 documentation</a> &raquo;</li>

          <li><a href="developer_guide.html" >SETLyze Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, 2011, GiMaRIS.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>